## ðŸ” Secure Your Network with **Amazon VPC**

### â“ Why do we need VPC security?

> Because once you allow internet traffic, **you must control who can enter and exit your network**.

By default:

* A new VPC is **isolated** (safe)
* Opening routes = **risk**
* So we add **firewalls**

---

## ðŸ§± The 2 Security Tools (MOST IMPORTANT)

### 1ï¸âƒ£ **Network Access Control Lists (NACL)**

**Firewall at subnet level**

* Works on **subnets**
* **Stateless** â†’ allow **both inbound & outbound**
* Supports **ALLOW and DENY**
* Default: allow all traffic

ðŸ‘‰ Use when you want **extra, broad control**

---

### 2ï¸âƒ£ **Security Groups**

**Firewall at EC2 level**

* Works on **instances**
* **Stateful** â†’ return traffic allowed automatically
* Only **ALLOW rules**
* Default: block all inbound

ðŸ‘‰ This is your **main and most-used protection**

---

## ðŸ§  Easy Memory Table

| Feature     | NACL        | Security Group   |
| ----------- | ----------- | ---------------- |
| Level       | Subnet      | EC2 Instance     |
| Stateful    | âŒ No        | âœ… Yes            |
| Allow/Deny  | Both        | Allow only       |
| Default use | Extra layer | Primary security |

---

## ðŸ† One-Line Summary (BEST)

> **NACL protects subnets, Security Groups protect instances.
> Use Security Groups first, NACL for extra safety.**

Thatâ€™s all you need âœ…


ðŸ” **Secure Your Network with Amazon VPC Security**
*A clear, layered, and visual way to understand how AWS protects your network*

![Image](https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2023/11/22/img2-8.png)

![Image](https://cloudviz.io/assets/aws-security-group-vs-nacl/security-groups.png)

![Image](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2020/11/17/anfw-single-az-deployment-diagram-high-res-1.png)

![Image](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2020/11/17/anfw-protected-vpc-high-res.png)

When you **open your VPC to the internet**, routing alone is **not enough**.
You must now answer the real security question:

> â“ *Who is allowed to talk to whom, on which ports, and in which direction?*

AWS solves this using **two firewall layers**:

---

# ðŸ§± The Two-Layer VPC Security Model

Think of VPC security like a **secure office building** ðŸ¢:

```
Internet
   |
[ Network ACL ]  â† Building gate (subnet-level)
   |
[ Security Group ] â† Office door (instance-level)
   |
[ EC2 Instance ]
```

Both layers work **together**, not against each other.

---

## ðŸ›¡ï¸ Layer 1: Network ACLs (NACLs)

ðŸ“ *Subnet-level firewall*

![Image](https://i.sstatic.net/zzeqI.png)

![Image](https://miro.medium.com/v2/resize%3Afit%3A708/0%2A0aLr31yyJWEND2ck.png)

### What is a Network ACL?

A **Network Access Control List** controls:

* Traffic **entering** a subnet
* Traffic **leaving** a subnet

ðŸ“Œ Automatically attached to every subnet

---

### ðŸ”‘ Key Characteristics of NACLs

| Feature          | Network ACL             |
| ---------------- | ----------------------- |
| Scope            | Subnet                  |
| Stateful?        | âŒ Stateless             |
| Rules            | Allow **and** Deny      |
| Default behavior | Allow all               |
| Applies to       | All resources in subnet |

---

### âš ï¸ Stateless = Double Work Required

Because NACLs are **stateless**:

ðŸ‘‰ You must allow **both directions**

Example: HTTPS (port 443)

* âœ… Inbound: Allow 443
* âœ… Outbound: Allow 443

âŒ If outbound is blocked â†’ browser never gets response

---

### ðŸ§  When to Use NACLs

* Broad **subnet-wide rules**
* Extra **defense layer**
* Blocking known bad IP ranges
* Compliance-heavy environments

Most teams:

> âœ”ï¸ Keep NACLs mostly default
> âœ”ï¸ Do fine-grained control with Security Groups

---

## ðŸ” Layer 2: Security Groups

ðŸ“ *Instance-level firewall*

![Image](https://docs.aws.amazon.com/images/vpc/latest/userguide/images/security-group-details.png)

![Image](https://d2908q01vomqb2.cloudfront.net/22d200f8670dbdb3e253a90eee5098477c95c23d/2020/10/01/AWS-Firewall-Manager-3-Scenarios-ForSocial.jpg)

Security Groups are attached directly to **Amazon EC2 instances**.

---

### ðŸ”‘ Key Characteristics of Security Groups

| Feature          | Security Group |
| ---------------- | -------------- |
| Scope            | Instance       |
| Stateful?        | âœ… Stateful     |
| Rules            | Allow only     |
| Default inbound  | Deny all       |
| Default outbound | Allow all      |

ðŸ“Œ **Mandatory** for every EC2 instance

---

### ðŸ§  Stateful = Smart Firewall

If traffic is allowed **in**, return traffic is:

* Automatically allowed
* No outbound rule needed

Example:

* Allow inbound HTTP (80)
* Response traffic? âœ… Automatically allowed

---

### ðŸŒ Common Web Server Rules

| Port | Protocol | Purpose                    |
| ---- | -------- | -------------------------- |
| 80   | HTTP     | Web traffic                |
| 443  | HTTPS    | Secure web traffic         |
| 22   | SSH      | Admin access (restricted!) |

---

## ðŸ§© How NACLs & Security Groups Work Together

```
User Request
   â†“
Network ACL (Subnet)
   â†“
Security Group (EC2)
   â†“
Application
```

â— **Traffic must pass BOTH layers**

If either layer blocks traffic â†’ request fails

---

## ðŸ§  Default Security Strategy (Best Practice)

âœ” Leave **NACLs mostly open**
âœ” Use **Security Groups** for control
âœ” Allow **only required ports**
âœ” Restrict SSH to trusted IPs
âœ” Use **multiple security groups** if needed

This gives:

* ðŸ” Strong security
* âš™ï¸ Easy management
* ðŸ“ˆ Scalability

---

## ðŸ§ª Example: Employee Directory App

### Public Subnet

* NACL: Default (allow all)
* Route: Internet Gateway

### EC2 Instance

* Security Group:

  * Allow HTTP (80)
  * Allow HTTPS (443)
  * Deny everything else (by default)

âœ… Secure
âœ… Simple
âœ… Exam-friendly

---

## ðŸ§  Exam Gold Nuggets â­

* Security Groups = **stateful**
* NACLs = **stateless**
* Security Groups = **allow rules only**
* NACLs = **allow + deny**
* Subnet is public/private due to **routing**, not security groups
* Every EC2 **must** have a security group

---

## ðŸ§± Final Mental Model (Memorize This)

> **NACL = Subnet firewall (coarse control)**
> **Security Group = Instance firewall (precise control)**

Layered security = **Defense in Depth** ðŸ”’
