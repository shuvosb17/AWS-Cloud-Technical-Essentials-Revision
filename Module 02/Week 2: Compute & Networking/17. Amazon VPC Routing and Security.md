## **Amazon VPC Routing and Security** âœ…

---

## ðŸŒ **Amazon VPC Routing**

### ðŸ—ºï¸ Main Route Table

* Created **automatically** with every VPC
* Controls **where traffic goes**
* Default rule:
  ðŸ‘‰ **All subnets can talk to each other (local traffic allowed)**

**Route table = Destination + Target**

* Destination â†’ where traffic should go
* Target â†’ how it gets there (local, IGW, etc.)

---

### ðŸ§­ Custom Route Tables

* Used when you want **different routing per subnet**
* If attached â†’ subnet uses it **instead of main route table**
* Still includes the **local route by default**

---

## ðŸ” Subnet Security: **Network Access Control Lists (NACL)**

* Firewall at **subnet level**
* **Stateless** â†’ must allow **both inbound & outbound**
* Supports **ALLOW + DENY**
* Default: allow all traffic

âš ï¸ Example:

* Allow inbound **443**
* Must allow outbound **1025â€“65535** (ephemeral ports)

---

## ðŸ–¥ï¸ Instance Security: **Security Groups**

* Firewall at **EC2 level**
* **Stateful** â†’ return traffic allowed automatically
* Only **ALLOW rules**
* Default: block all inbound, allow all outbound

Used to:

* Allow HTTP/HTTPS
* Isolate **Web â†’ App â†’ DB** tiers

---

## ðŸ§  Easy Memory Table

| Feature    | Route Table       | NACL            | Security Group    |
| ---------- | ----------------- | --------------- | ----------------- |
| Purpose    | Traffic direction | Subnet firewall | Instance firewall |
| Level      | Subnet            | Subnet          | EC2               |
| Stateful   | â€”                 | âŒ No            | âœ… Yes             |
| Allow/Deny | â€”                 | Both            | Allow only        |

---

## ðŸ† One-Line Summary (BEST)

> **Route tables decide where traffic goes,
> NACLs protect subnets,
> Security Groups protect EC2 instances.**

Thatâ€™s all you need ðŸ‘


## ðŸ” **Amazon VPC Routing and Security**

*A clear, layered, and visual explanation â€” from traffic paths to firewalls*

![Image](https://docs.aws.amazon.com/images/vpc/latest/userguide/images/subnet-association.png)

![Image](https://media.geeksforgeeks.org/wp-content/uploads/20240514172628/aws-security-groups.webp)

![Image](https://cloudiofy.com/wp-content/uploads/2022/07/security-group-vs-network-acl.png)

Think of **VPC routing and security** like designing a **city** ðŸ™ï¸

* **Route tables** = road maps
* **Subnets** = neighborhoods
* **Network ACLs** = gates at neighborhood entrances
* **Security Groups** = locks on each house

Letâ€™s build this **layer by layer** ðŸ‘‡

---

# ðŸ§­ PART 1: VPC ROUTING (How traffic moves)

## ðŸ—ºï¸ What Is a Route Table?

A **route table** decides:

> ðŸ‘‰ *â€œIf traffic is going **there**, which **path** should it take?â€*

A route table contains:

* **Destination** â†’ *Where the traffic wants to go*
* **Target** â†’ *How it gets there*

---

## ðŸ§± The Main Route Table

When you create a **Amazon Virtual Private Cloud**, AWS **automatically creates**:

### ðŸ‘‰ **Main Route Table**

### Default behavior:

```
Destination: VPC CIDR (e.g. 10.0.0.0/16)
Target: local
```

### Meaning:

âœ… All subnets inside the VPC can talk to each other
âŒ No internet access yet

ðŸ“Œ AWS assumes:

> *â€œIf you created subnets, you want internal communication.â€*

---

## ðŸŽ¯ Route Table Anatomy (Simple View)

| Component       | Meaning                      |
| --------------- | ---------------------------- |
| **Destination** | IP range traffic is going to |
| **Target**      | Gateway or service used      |

Example:

```
10.0.0.0/16 â†’ local
0.0.0.0/0   â†’ Internet Gateway
```

---

## ðŸ§© Custom Route Tables (Granular Control)

The **main route table** is global, but apps need **precision** ðŸŽ¯

### Why custom route tables?

* Public web servers
* Private databases
* Different internet access rules

### Key Rule:

> **If a subnet is associated with a custom route table, it ignores the main route table.**

---

### ðŸŒ Public Subnet Routing

```
Destination: 0.0.0.0/0
Target: Internet Gateway
```

âœ… Internet access enabled

---

### ðŸ”’ Private Subnet Routing

```
Destination: 10.0.0.0/16
Target: local
```

âŒ No direct internet access

ðŸ“Œ **Important**

> Subnets are called *public* or *private* because of **route tables**, not because of the subnet itself.

---

# ðŸ§± PART 2: SUBNET-LEVEL SECURITY (Network ACLs)

## ðŸš§ What Is a Network ACL?

A **Network ACL (NACL)** is:

> ðŸ”¥ *A firewall at the **subnet level***

It controls:

* Traffic **entering** a subnet
* Traffic **leaving** a subnet

---

## ðŸ§  Key Properties of Network ACLs

| Feature       | Network ACL      |
| ------------- | ---------------- |
| Level         | Subnet           |
| Default       | Allow all        |
| Rules         | Allow + Deny     |
| Order matters | âœ… Yes            |
| Stateful      | âŒ No (stateless) |

---

## ðŸ“¦ Stateless = Important Concept

**Stateless means**:

> If traffic goes **in**, return traffic must be **explicitly allowed out**

---

### ðŸ” Example: HTTPS with NACL

#### Inbound

| Port | Action |
| ---- | ------ |
| 443  | ALLOW  |
| *    | DENY   |

#### Outbound

| Port       | Action |
| ---------- | ------ |
| 1025â€“65535 | ALLOW  |
| *          | DENY   |

ðŸ“Œ Why?

* HTTPS starts on **443**
* Response returns via **ephemeral ports**

---

## âœ… When Should You Use Network ACLs?

* Extra security layer
* Compliance requirements
* Broad subnet-level filtering

Otherwise ðŸ‘‰ **defaults are fine**

---

# ðŸ§± PART 3: INSTANCE-LEVEL SECURITY (Security Groups)

## ðŸ›¡ï¸ What Is a Security Group?

A **Security Group** is:

> ðŸ” *A firewall attached directly to an **Amazon EC2 instance***

---

## ðŸ§  Key Properties of Security Groups

| Feature       | Security Group |
| ------------- | -------------- |
| Level         | Instance       |
| Default       | Deny inbound   |
| Rules         | Allow only     |
| Order matters | âŒ No           |
| Stateful      | âœ… Yes          |

---

## ðŸ” Stateful = Superpower

If traffic is allowed **in**, return traffic is **automatically allowed out**
ðŸ‘‰ No need for outbound rules

---

## ðŸŒ Example: Web Server Security Group

### Inbound Rules

| Protocol | Port | Source    |
| -------- | ---- | --------- |
| HTTP     | 80   | 0.0.0.0/0 |
| HTTPS    | 443  | 0.0.0.0/0 |

### Outbound

âœ… Allow all (default)

---

# ðŸ§© PART 4: Layered Security (Best Practice)

AWS uses **defense in depth** ðŸ§±ðŸ§±ðŸ§±

```
Internet
 â†“
Route Table (can it reach?)
 â†“
Network ACL (allowed in subnet?)
 â†“
Security Group (allowed to instance?)
 â†“
EC2 Application
```

---

## ðŸ—ï¸ Three-Tier Architecture Example

| Tier | Access Allowed   |
| ---- | ---------------- |
| Web  | Internet â†’ HTTPS |
| App  | Web â†’ HTTP       |
| DB   | App â†’ MySQL      |

ðŸš€ **Security Groups make this easy**
(no VLAN complexity like on-prem)

---

# ðŸ§  EXAM MEMORY TABLE (Very Important)

| Feature    | Route Table  | Network ACL     | Security Group    |
| ---------- | ------------ | --------------- | ----------------- |
| Controls   | Traffic path | Subnet firewall | Instance firewall |
| Level      | Subnet/VPC   | Subnet          | Instance          |
| Allow/Deny | N/A          | Both            | Allow only        |
| Stateful   | N/A          | âŒ No            | âœ… Yes             |
| Default    | Local only   | Allow all       | Deny inbound      |

---

# ðŸ§  One-Line Summary

> **Route tables decide *where* traffic goes**
> **NACLs decide *which traffic enters a subnet***
> **Security groups decide *who can talk to an instance***

---
