## ğŸ” **Amazon VPC Routing and Security**

*A clear, layered, and visual explanation â€” from traffic paths to firewalls*

![Image](https://docs.aws.amazon.com/images/vpc/latest/userguide/images/subnet-association.png)

![Image](https://media.geeksforgeeks.org/wp-content/uploads/20240514172628/aws-security-groups.webp)

![Image](https://cloudiofy.com/wp-content/uploads/2022/07/security-group-vs-network-acl.png)

Think of **VPC routing and security** like designing a **city** ğŸ™ï¸

* **Route tables** = road maps
* **Subnets** = neighborhoods
* **Network ACLs** = gates at neighborhood entrances
* **Security Groups** = locks on each house

Letâ€™s build this **layer by layer** ğŸ‘‡

---

# ğŸ§­ PART 1: VPC ROUTING (How traffic moves)

## ğŸ—ºï¸ What Is a Route Table?

A **route table** decides:

> ğŸ‘‰ *â€œIf traffic is going **there**, which **path** should it take?â€*

A route table contains:

* **Destination** â†’ *Where the traffic wants to go*
* **Target** â†’ *How it gets there*

---

## ğŸ§± The Main Route Table

When you create a **Amazon Virtual Private Cloud**, AWS **automatically creates**:

### ğŸ‘‰ **Main Route Table**

### Default behavior:

```
Destination: VPC CIDR (e.g. 10.0.0.0/16)
Target: local
```

### Meaning:

âœ… All subnets inside the VPC can talk to each other
âŒ No internet access yet

ğŸ“Œ AWS assumes:

> *â€œIf you created subnets, you want internal communication.â€*

---

## ğŸ¯ Route Table Anatomy (Simple View)

| Component       | Meaning                      |
| --------------- | ---------------------------- |
| **Destination** | IP range traffic is going to |
| **Target**      | Gateway or service used      |

Example:

```
10.0.0.0/16 â†’ local
0.0.0.0/0   â†’ Internet Gateway
```

---

## ğŸ§© Custom Route Tables (Granular Control)

The **main route table** is global, but apps need **precision** ğŸ¯

### Why custom route tables?

* Public web servers
* Private databases
* Different internet access rules

### Key Rule:

> **If a subnet is associated with a custom route table, it ignores the main route table.**

---

### ğŸŒ Public Subnet Routing

```
Destination: 0.0.0.0/0
Target: Internet Gateway
```

âœ… Internet access enabled

---

### ğŸ”’ Private Subnet Routing

```
Destination: 10.0.0.0/16
Target: local
```

âŒ No direct internet access

ğŸ“Œ **Important**

> Subnets are called *public* or *private* because of **route tables**, not because of the subnet itself.

---

# ğŸ§± PART 2: SUBNET-LEVEL SECURITY (Network ACLs)

## ğŸš§ What Is a Network ACL?

A **Network ACL (NACL)** is:

> ğŸ”¥ *A firewall at the **subnet level***

It controls:

* Traffic **entering** a subnet
* Traffic **leaving** a subnet

---

## ğŸ§  Key Properties of Network ACLs

| Feature       | Network ACL      |
| ------------- | ---------------- |
| Level         | Subnet           |
| Default       | Allow all        |
| Rules         | Allow + Deny     |
| Order matters | âœ… Yes            |
| Stateful      | âŒ No (stateless) |

---

## ğŸ“¦ Stateless = Important Concept

**Stateless means**:

> If traffic goes **in**, return traffic must be **explicitly allowed out**

---

### ğŸ” Example: HTTPS with NACL

#### Inbound

| Port | Action |
| ---- | ------ |
| 443  | ALLOW  |
| *    | DENY   |

#### Outbound

| Port       | Action |
| ---------- | ------ |
| 1025â€“65535 | ALLOW  |
| *          | DENY   |

ğŸ“Œ Why?

* HTTPS starts on **443**
* Response returns via **ephemeral ports**

---

## âœ… When Should You Use Network ACLs?

* Extra security layer
* Compliance requirements
* Broad subnet-level filtering

Otherwise ğŸ‘‰ **defaults are fine**

---

# ğŸ§± PART 3: INSTANCE-LEVEL SECURITY (Security Groups)

## ğŸ›¡ï¸ What Is a Security Group?

A **Security Group** is:

> ğŸ” *A firewall attached directly to an **Amazon EC2 instance***

---

## ğŸ§  Key Properties of Security Groups

| Feature       | Security Group |
| ------------- | -------------- |
| Level         | Instance       |
| Default       | Deny inbound   |
| Rules         | Allow only     |
| Order matters | âŒ No           |
| Stateful      | âœ… Yes          |

---

## ğŸ” Stateful = Superpower

If traffic is allowed **in**, return traffic is **automatically allowed out**
ğŸ‘‰ No need for outbound rules

---

## ğŸŒ Example: Web Server Security Group

### Inbound Rules

| Protocol | Port | Source    |
| -------- | ---- | --------- |
| HTTP     | 80   | 0.0.0.0/0 |
| HTTPS    | 443  | 0.0.0.0/0 |

### Outbound

âœ… Allow all (default)

---

# ğŸ§© PART 4: Layered Security (Best Practice)

AWS uses **defense in depth** ğŸ§±ğŸ§±ğŸ§±

```
Internet
 â†“
Route Table (can it reach?)
 â†“
Network ACL (allowed in subnet?)
 â†“
Security Group (allowed to instance?)
 â†“
EC2 Application
```

---

## ğŸ—ï¸ Three-Tier Architecture Example

| Tier | Access Allowed   |
| ---- | ---------------- |
| Web  | Internet â†’ HTTPS |
| App  | Web â†’ HTTP       |
| DB   | App â†’ MySQL      |

ğŸš€ **Security Groups make this easy**
(no VLAN complexity like on-prem)

---

# ğŸ§  EXAM MEMORY TABLE (Very Important)

| Feature    | Route Table  | Network ACL     | Security Group    |
| ---------- | ------------ | --------------- | ----------------- |
| Controls   | Traffic path | Subnet firewall | Instance firewall |
| Level      | Subnet/VPC   | Subnet          | Instance          |
| Allow/Deny | N/A          | Both            | Allow only        |
| Stateful   | N/A          | âŒ No            | âœ… Yes             |
| Default    | Local only   | Allow all       | Deny inbound      |

---

# ğŸ§  One-Line Summary

> **Route tables decide *where* traffic goes**
> **NACLs decide *which traffic enters a subnet***
> **Security groups decide *who can talk to an instance***

---

If you want next, I can:

* Build a **full exam-style scenario**
* Compare **NACL vs SG trick questions**
* Walk through **real routing failures**
* Create a **cheat sheet PDF-style summary**

Just tell me ğŸ”¥



## ğŸ› ï¸ **Common Network Troubleshooting Steps for Amazon VPC**

*A clear, visual, step-by-step checklist for when your public EC2 app wonâ€™t load*

![Image](https://docs.aws.amazon.com/images/vpc/latest/userguide/images/vpc-example-private-subnets.png)

![Image](https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2020/03/19/Slide1.png)

![Image](https://cloudviz.io/assets/aws-security-group-vs-nacl/security-groups.png)

![Image](https://media.geeksforgeeks.org/wp-content/uploads/20230918171703/AWS-Nacl-vs-Security-group.png)

When a **web application on an EC2 instance** doesnâ€™t open in the browser, the problem is almost **never just one thing**.
In **Amazon Virtual Private Cloud**, internet access depends on **multiple layers working together**.

Think of this like a **pipeline** ğŸŒŠ
If *any* valve is closed â†’ traffic stops.

---

# ğŸ§  Mental Model (Visualize First)

```
Internet
  â†“
Internet Gateway (IGW)
  â†“
Route Table
  â†“
Subnet (NACL)
  â†“
EC2 Instance (Security Group)
  â†“
Application + Web Server
```

Now letâ€™s **debug this pipeline from top to bottom** ğŸ‘‡

---

## âœ… 1. Internet Gateway (IGW)

### ğŸ” What to check

* Is an **Internet Gateway attached** to your VPC?

### âŒ Common failure

* IGW exists but is **not attached** to the VPC

### âœ… Why it matters

Without an IGW:

> ğŸš« **No traffic can enter or leave the VPC**

ğŸ“Œ VPC â†’ **Internet Gateway = door to the internet**

---

## âœ… 2. Route Tables (Subnet Routing)

### ğŸ” What to check

Look at the **route table associated with your EC2 subnet**.

You must see:

```
Destination: 0.0.0.0/0
Target: Internet Gateway
```

### âŒ Common failure

* Route exists in a different route table
* Subnet is associated with the **wrong route table**

### âœ… Why it matters

> The IGW lets traffic *in*, but the route table tells traffic *where to go*

---

## âœ… 3. Security Groups (Instance Firewall)

### ğŸ” What to check

On the EC2 security group, verify **inbound rules**:

| Protocol | Port | Source    |
| -------- | ---- | --------- |
| HTTP     | 80   | 0.0.0.0/0 |
| HTTPS    | 443  | 0.0.0.0/0 |

Outbound:

* Usually **Allow All** (default)

### âŒ Common failures

* Port 80/443 missing
* Source too restrictive (not `0.0.0.0/0`)

### âœ… Why it matters

Security groups are:

* **Stateful**
* Default = **deny all inbound**

ğŸ“Œ No rule = no traffic

---

## âœ… 4. Network ACLs (Subnet Firewall)

### ğŸ” What to check

Ensure **both inbound AND outbound** rules allow traffic.

Example (HTTP/HTTPS):

**Inbound**

* Allow TCP 80 / 443

**Outbound**

* Allow TCP **1025â€“65535** (ephemeral ports)

### âŒ Common failure

* Inbound allowed, outbound blocked

### âœ… Why it matters

Network ACLs are:

* **Stateless**
* Require **explicit inbound + outbound rules**

ğŸ“Œ Response traffic uses **ephemeral ports**

---

## âœ… 5. Public IP Address

### ğŸ” What to check

Your EC2 instance must have:

* A **public IPv4 address** or **Elastic IP**

Check in the **Amazon EC2 console â†’ Instance details**

### âŒ Common failure

* Instance launched without public IP
* Subnet setting disables auto-assign public IP

### âœ… Why it matters

No public IP =

> ğŸŒ Internet has no idea where your instance is

---

## âœ… 6. HTTP vs HTTPS Mismatch

### ğŸ” What to check

* Is your app using **HTTP or HTTPS**?
* Does your browser URL match?

Example:

```
http://<public-ip>
```

### âŒ Common failures

* Browser auto-forces HTTPS
* SSL not configured but HTTPS used

### âœ… Course-specific reminder

ğŸ“Œ **This app uses HTTP**
Make sure the URL starts with:

```
http://
```

---

## âœ… 7. User Data Script (Boot-Time Setup)

### ğŸ” What to check

If you used **user data**, verify it ran successfully.

Check logs:

```bash
/var/log/cloud-init.log
/var/log/cloud-init-output.log
```

### âŒ Common failures

* Script error
* Package install failed
* Web server never started

### âœ… Why it matters

If Apache/Nginx never installed â†’ nothing to serve

---

## âœ… 8. IAM Permissions (Roles & Policies)

### ğŸ” What to check

Does the EC2 instance role allow access to:

* S3
* DynamoDB
* RDS
* Other AWS services used by the app

### âŒ Common failure

* Missing IAM role
* Incorrect policy attached

### âœ… Why it matters

App may load but **crash internally** due to denied access

---

## âœ… 9. Personal / Corporate Network Restrictions

### ğŸ” What to check

* Are you on a corporate VPN?
* Is outbound traffic restricted?

### âŒ Common failure

* Firewall blocks ports 80/443
* Proxy blocks unknown IP ranges

### âœ… Quick test

Try accessing from:

* Mobile hotspot
* Different network

---

## âœ… 10. Application & Web Server Health

### ğŸ” What to check

* Is the app actually running?
* Is Apache/Nginx started?

Example:

```bash
sudo systemctl status nginx
sudo systemctl status httpd
```

Check:

* Application logs
* Web server logs

### âŒ Common failures

* Service not started
* App crashed on launch
* Wrong document root

---

# ğŸ§  Fast Exam / Real-World Checklist (Order Matters!)

1ï¸âƒ£ Internet Gateway
2ï¸âƒ£ Route Table
3ï¸âƒ£ Security Group
4ï¸âƒ£ Network ACL
5ï¸âƒ£ Public IP
6ï¸âƒ£ HTTP vs HTTPS
7ï¸âƒ£ User Data
8ï¸âƒ£ IAM Permissions
9ï¸âƒ£ Your Network
ğŸ”Ÿ Application itself

---

## ğŸ§  One-Line Summary

> **If a public EC2 app doesnâ€™t load, always debug from the network edge inward â€” not the other way around.**

